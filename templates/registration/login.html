{% extends "base.html" %}
{% load static %}
{% block title %}로그인{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block content %}
<div class="auth-shell">
  <div class="auth-grid">
    <section class="auth-panel">
      <div class="auth-form">
        <div class="auth-logo">H</div>
        <header class="auth-header">
          <h1>Welcome back</h1>
          <p>Sign in to your account</p>
        </header>

        <!-- ✅ 소셜 로그인 버튼 (엔드포인트 연결 전까지 # 유지) -->
        <div class="auth-oauth">
          <a class="oauth-button oauth-button--kakao" href="{% url 'users:kakao_login' %}" aria-label="카카오 로그인">
            <span class="oauth-button__icon oauth-button__icon--kakao" aria-hidden="true">K</span>
            <span>Continue with Kakao</span>
          </a>
          <a class="oauth-button oauth-button--naver" href="{% url 'users:naver_login' %}" aria-label="네이버 로그인">
            <span class="oauth-button__icon" aria-hidden="true">
              <img src="{% static 'img/naver.svg' %}" alt="Naver" />
            </span>
            <span>Continue with Naver</span>
          </a>
        </div>

        <div class="auth-divider"><span>or</span></div>

        <!-- ✅ 기본 로그인 폼: login으로 POST + 성공 시 대시보드로 이동 -->
        <form method="post" action="{% url 'login' %}" class="auth-fields" novalidate>
          {% csrf_token %}

          {# next 파라미터가 있다면 유지, 없으면 대시보드로 #}
          {% if next %}
            <input type="hidden" name="next" value="{{ next }}">
          {% else %}
            <input type="hidden" name="next" value="{% url 'tasks:dashboard' %}">
          {% endif %}

          {% if form.non_field_errors %}
            <div class="auth-error">
              {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}

          <label class="auth-field" for="id_username">
            <span>Email</span>
            <input
              type="email"
              name="username"
              id="id_username"
              value="{{ form.username.value|default_if_none:'' }}"
              class="auth-input"
              placeholder="Enter your email"
              required
            />
            {% if form.username.errors %}
              <small class="auth-error-text">{{ form.username.errors.0 }}</small>
            {% endif %}
          </label>

          <label class="auth-field" for="id_password">
            <span>Password</span>
            <input
              type="password"
              name="password"
              id="id_password"
              class="auth-input auth-input--password"
              placeholder="Enter your password"
              required
            />
            {% if form.password.errors %}
              <small class="auth-error-text">{{ form.password.errors.0 }}</small>
            {% endif %}
          </label>

          <div class="auth-meta">
            <label class="auth-remember">
              <input type="checkbox" name="remember" />
              <span>Remember me</span>
            </label>
            <a href="{% url 'password_reset' %}" class="auth-link">Forgot password?</a>
          </div>

          <button type="submit" class="auth-submit">Sign in</button>
        </form>

        <p class="auth-footer">
          Don't have an account?
          <a href="{% url 'user_signup' %}" class="auth-link">Sign up</a>
        </p>
      </div>
    </section>

    <aside class="auth-side">
      <div class="auth-side__quote">
        <blockquote>
          <p>Getting AI, auth, and data in one place simplified our workflow.</p>
        </blockquote>
      </div>
    </aside>
  </div>
</div>
{% endblock %}
